# Go-Study2 核心配置文件
# 此文件包含 Web 服务、数据库、安全及业务逻辑的基础配置

# ==========================================
# 网络协议配置 (HTTP/HTTPS)
# ==========================================

# HTTP 配置：常规明文传输配置
http:
  # 服务监听端口 (int)。本地开发环境默认 8080
  port: 8080

# HTTPS 配置：加密传输配置。生产环境强烈建议开启
https:
  # 是否开启 HTTPS (bool)。若为 true，需确保 certFile 和 keyFile 路径正确且有效
  enabled: false
  # HTTPS 监听端口 (int)。标准端口为 443
  port: 8443
  # 服务端公钥证书路径 (string)。支持绝对路径或相对于 backend 目录的相对路径
  certFile: "./configs/certs/server.crt"
  # 服务端私钥文件路径 (string)。务必妥善保管，权限建议设为 600
  keyFile: "./configs/certs/server.key"
  # 是否跳过 TLS 客户端校验 (bool)。仅用于开发环境下忽略自签名证书警告
  insecureSkipVerify: false
  # CA 根证书路径 (string)。用于验证客户端证书或建立自签名证书信任链
  caFile: ""

# 服务基础通用设置
server:
  # 绑定监听地址 (string)。"127.0.0.1" 仅限本地访问，"0.0.0.0" 允许外部所有来源访问
  host: "127.0.0.1"
  # 优雅停机超时时间 (int, 单位:秒)。接收停机信号后，等待存量请求处理完成的最长时间
  shutdownTimeout: 10

# ==========================================
# 存储层配置 (Database)
# ==========================================

# 数据库配置：当前默认采用高性能嵌入式数据库 SQLite3
database:
  # 驱动类型 (string)。目前程序适配 sqlite3
  type: "sqlite3"
  # 数据库文件保存路径 (string)。确保运行账号对该目录有读写权限
  path: "./data/gostudy.db"
  # 连接池最大打开连接数 (int)。SQLite 建议设为 1 或较小值以减少文件锁竞争
  maxOpenConns: 10
  # 连接池最大空闲连接数 (int)
  maxIdleConns: 5
  # 连接最大存活时间 (int, 单位:秒)。过期连接将被重连，防止网络僵死
  connMaxLifetime: 3600
  # 慢查询记录阈值 (int, 单位:毫秒)。SQL 执行耗时超过此值将记录到 slow 日志
  slowThreshold: 100
  # SQLite 特有的 PRAGMA 运行时参数优化
  pragmas:
    # 开启 WAL (Write-Ahead Logging) 模式，极大提升并发读写性能
    - "journal_mode=WAL"
    # 设置数据库 busy 时的重试等待超时 (单位:毫秒)
    - "busy_timeout=5000"
    # 设置同步级别。NORMAL 在保证数据库损坏风险极低的前提下，写入性能优于 FULL
    - "synchronous=NORMAL"
    # 设置页面缓存大小 (int)。负值表示 KiB，此处为约 64MiB
    - "cache_size=-64000"
    # 强制开启外键约束检查
    - "foreign_keys=ON"

# ==========================================
# 安全与认证配置 (Security)
# ==========================================

# JWT (JSON Web Token) 用户登录态校验配置
jwt:
  # 签名秘钥 (string)。生产环境建议通过环境变量注入，切勿泄露
  secret: "S3cureTestKey_987!"
  # Access Token 有效期 (int, 单位:秒)。过期需调用 refresh 接口
  accessTokenExpiry: 604800
  # Refresh Token 有效期 (int, 单位:秒)。用于获取新的 Access Token
  refreshTokenExpiry: 604800
  # Token 签名发行者标识
  issuer: "go-study2"

# ==========================================
# 业务功能配置
# ==========================================

# 静态资源托管配置
static:
  # 是否开启前端静态资源服务 (bool)
  enabled: true
  # 前端编译产物 (dist/out) 的存放目录路径
  path: "../frontend/out"
  # 开启单页应用 (SPA) 路由支持。若路径不存在则自动返回 index.html
  spaFallback: true

# 学习进度算法机制配置
progress:
  # 阅读速度基准 (float, 字符/秒)。用于预估章节平均阅读耗时
  readCharsPerSec: 5.0
  # 不同学习主题的难度权重系数 (float)。系数越高，预估耗时越长
  difficulty:
    # 词法元素
    lexical_elements: 1.0
    # 常量
    constants: 1.1
    # 变量
    variables: 1.0
    # 数据类型
    types: 1.2
  # 章节预估有效时间的强制上下界 (int, 单位:秒)
  minSeconds: 60
  maxSeconds: 3600
  # 学习完成度触发阈值 (float, 0-1)。用户停留时长达到 (预估时长 * completionFraction) 即标记为已完成
  completionFraction: 0.5

# Quiz 题库与测验逻辑配置
quiz:
  # 题库 Markdown 文件所在的根目录
  dataPath: quiz_data
  # 每次小测验生成的题目数量配额
  questionCount:
    # 单选题个数
    single: 4
    # 多选题个数
    multiple: 4
  # 题目难度随机生成的占比分布 (百分比)
  difficultyDistribution:
    # 简单题 (40%)
    easy: 40
    # 中等题 (40%)
    medium: 40
    # 困难题 (20%)
    hard: 20
  # 从文件系统异步加载题库的超时限制 (duration)
  loadTimeout: 5s
  # 题库内容校验逻辑
  validation:
    # 严格模式：格式校验失败将抛出错误
    strictMode: true
    # 快速失败：发现首个格式错误立即中断加载
    failFast: true
